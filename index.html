<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãŠã°ã‚ã¡ã‚ƒã‚“ã®ãŠåŠ©ã‘ã‚¢ãƒ—ãƒª</title>
    <style>
        /* å…¨ä½“ã®è¨­å®š */
        body {
            font-family: "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif;
            margin: 0;
            padding: 10px;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        .button-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            height: 60%;
        }

        button {
            flex: 1;
            border: none;
            border-radius: 20px;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 8px 0 #999;
            transition: all 0.1s;
        }

        button:active {
            transform: translateY(4px);
            box-shadow: 0 4px 0 #666;
        }

        button:disabled {
            background-color: #ccc !important;
            box-shadow: none !important;
            transform: translateY(4px);
            color: #666 !important;
        }

        .btn-meal { background-color: #FF8C00; color: white; }
        .btn-buy { background-color: #2E8B57; color: white; }
        .btn-call { background-color: #FFD700; color: black; }

        /* æ²ç¤ºæ¿ã‚¨ãƒªã‚¢ */
        .message-board {
            margin-top: 20px;
            padding: 15px;
            background-color: #fffde7; /* æ²ç¤ºæ¿ã‚‰ã—ãå°‘ã—é»„è‰²ã£ã½ã */
            border: 5px solid #333;
            border-radius: 15px;
            height: 35%;
            overflow-y: auto;
        }

        #boardMessage {
            font-size: 36px; /* æ–‡å­—ã‚’ã•ã‚‰ã«å¤§ãã */
            font-weight: bold;
            color: #d32f2f; /* ç›®ç«‹ã¤è‰² */
            margin: 10px 0;
            white-space: pre-wrap; /* æ”¹è¡Œã‚’åæ˜ ã•ã›ã‚‹ */
        }

        #notification {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0,0,0,0.9);
            color: white;
            padding: 40px;
            border-radius: 20px;
            font-size: 40px;
            text-align: center;
            z-index: 100;
            width: 80%;
        }
    </style>
</head>
<body onload="updateMessage()"> <div id="notification"></div>

    <div class="button-container">
        <button id="mealBtn" class="btn-meal" onclick="sendToGas('ğŸš ã”ã¯ã‚“é£Ÿã¹ãŸã‚ˆ')">
            ğŸš ã”ã¯ã‚“é£Ÿã¹ãŸã‚ˆ
        </button>
        <button id="buyBtn" class="btn-buy" onclick="sendToGas('ğŸ¤ ã“ã‚Œè²·ã£ã¦')">
            ğŸ¤ ã“ã‚Œè²·ã£ã¦
        </button>
        <button id="callBtn" class="btn-call" onclick="sendToGas('ğŸ“ å®¶æ—ã«é›»è©±ã—ãŸã„ã‚ˆ')">
            ğŸ“ å®¶æ—ã«é›»è©±ã™ã‚‹
        </button>
    </div>

    <div class="message-board">
        <div style="font-size: 20px; color: #666;">ğŸ  å®¶æ—ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</div>
        <div id="boardMessage">èª­ã¿è¾¼ã¿ä¸­...</div>
    </div>

<script>
        // ã€é‡è¦ã€‘ã‚ãªãŸã®GASã®ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªURLã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„
        const GAS_URL = "https://script.google.com/macros/s/AKfycbwRTxgPixvXGdW88lr14m2irbraEkAShYwcma2Ovv4GzBKz78YtoSYIQ6VoARUamKWH/exec";

        // --- 1. Slackã¸é€šçŸ¥ã‚’é€ã‚‹æ©Ÿèƒ½ ---
        async function sendToGas(message) {
            const buttons = document.querySelectorAll('button');
            buttons.forEach(btn => btn.disabled = true);
            showPopup("å®¶æ—ã«ãŠçŸ¥ã‚‰ã›ã—ã¦ã„ã¾ã™...");

            try {
                // é€šçŸ¥ã‚’é€ã‚‹éš›ã‚‚ã€Œredirect: "follow"ã€ã‚’å…¥ã‚Œã‚‹ã¨ã‚ˆã‚Šå®‰å®šã—ã¾ã™
                await fetch(GAS_URL, {
                    method: 'POST',
                    body: JSON.stringify({ text: message }),
                    headers: { 'Content-Type': 'text/plain' },
                    redirect: "follow" 
                });
                showPopup(message + "\nã‚’å®¶æ—ã«é€ã‚Šã¾ã—ãŸï¼");
            } catch (error) {
                console.error("é€ä¿¡ã‚¨ãƒ©ãƒ¼:", error);
                showPopup("ã†ã¾ãé€ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚");
            }

            setTimeout(() => {
                buttons.forEach(btn => btn.disabled = false);
                hidePopup();
            }, 5000);
        }

        // --- 2. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã‚€æ©Ÿèƒ½ ---
        async function updateMessage() {
            try {
                // ã€ã“ã“ãŒä¿®æ­£ãƒã‚¤ãƒ³ãƒˆï¼ã€‘redirect: "follow" ã‚’è¿½åŠ ã—ã¾ã—ãŸ
                const response = await fetch(GAS_URL, { redirect: "follow" });
                
                // ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦è¡¨ç¤º
                const data = await response.json();
                if (data.message) {
                    document.getElementById('boardMessage').innerText = data.message;
                }
            } catch (error) {
                console.error("èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:", error);
                // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã€Œèª­ã¿è¾¼ã¿ä¸­...ã€ã®ã¾ã¾ã«ãªã‚‰ãªã„ã‚ˆã†é…æ…®
                if(document.getElementById('boardMessage').innerText === "èª­ã¿è¾¼ã¿ä¸­...") {
                    document.getElementById('boardMessage').innerText = "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“";
                }
            }
        }

        // --- 3. 5åˆ†ãŠãã«è‡ªå‹•æ›´æ–°ã™ã‚‹è¨­å®š ---
        setInterval(updateMessage, 300000);

        function showPopup(text) {
            const popup = document.getElementById('notification');
            popup.innerText = text;
            popup.style.display = 'block';
        }

        function hidePopup() {
            document.getElementById('notification').style.display = 'none';
        }
    </script>
</body>
</html>